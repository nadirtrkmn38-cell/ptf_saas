{% extends 'base/base.html' %}

{% block title %}API AyarlarÄ± - PTF Tahmin{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">API AyarlarÄ±</h1>
    
    <!-- API AnahtarÄ± -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title">API AnahtarÄ±</h2>
            <p class="opacity-70 mb-4">API'ye eriÅŸmek iÃ§in bu anahtarÄ± kullanÄ±n.</p>
            
            <div class="form-control">
                <div class="input-group">
                    <input type="text" value="{{ user.api_key|default:'HenÃ¼z oluÅŸturulmadÄ±' }}" 
                        class="input input-bordered flex-1 font-mono text-sm" readonly id="apiKey">
                    <button type="button" onclick="copyApiKey()" class="btn btn-square">
                        ðŸ“‹
                    </button>
                </div>
            </div>
            
            <form method="POST" class="mt-4">
                {% csrf_token %}
                <button type="submit" name="regenerate_key" class="btn btn-warning btn-sm"
                    onclick="return confirm('Mevcut API anahtarÄ± geÃ§ersiz olacak. Devam etmek istiyor musunuz?')">
                    ðŸ”„ Yeni Anahtar OluÅŸtur
                </button>
            </form>
            
            <div class="alert alert-warning mt-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <span>API anahtarÄ±nÄ±zÄ± kimseyle paylaÅŸmayÄ±n. Yeni anahtar oluÅŸturursanÄ±z eski anahtar Ã§alÄ±ÅŸmayÄ± durduracaktÄ±r.</span>
            </div>
        </div>
    </div>
    
    <!-- KullanÄ±m Ä°statistikleri -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title">KullanÄ±m Ä°statistikleri</h2>
            
            <div class="stats stats-vertical lg:stats-horizontal shadow mt-4">
                <div class="stat">
                    <div class="stat-title">GÃ¼nlÃ¼k Limit</div>
                    <div class="stat-value">{{ user.get_api_limit }}</div>
                    <div class="stat-desc">Ã§aÄŸrÄ±/gÃ¼n</div>
                </div>
                <div class="stat">
                    <div class="stat-title">BugÃ¼n KullanÄ±lan</div>
                    <div class="stat-value text-primary">{{ user.api_calls_today }}</div>
                    <div class="stat-desc">Ã§aÄŸrÄ±</div>
                </div>
                <div class="stat">
                    <div class="stat-title">Kalan</div>
                    <div class="stat-value text-success">{{ api_calls_remaining }}</div>
                    <div class="stat-desc">Ã§aÄŸrÄ±</div>
                </div>
            </div>
            
            <div class="mt-4">
                <progress class="progress progress-primary w-full" 
                    value="{{ user.api_calls_today }}" max="{{ user.get_api_limit }}"></progress>
            </div>
            
            {% if user.subscription_plan == 'free' or user.subscription_plan == 'basic' %}
            <div class="mt-4">
                <a href="{% url 'pricing' %}" class="btn btn-primary btn-sm">
                    Limiti ArtÄ±r â†’
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- API DokÃ¼mantasyonu -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title">HÄ±zlÄ± BaÅŸlangÄ±Ã§</h2>
            
            <div class="mt-4 space-y-4">
                <!-- Authentication -->
                <div class="collapse collapse-arrow bg-base-200">
                    <input type="radio" name="api-accordion" checked="checked" />
                    <div class="collapse-title font-medium">
                        1. Authentication (JWT Token)
                    </div>
                    <div class="collapse-content">
                        <pre class="bg-neutral text-neutral-content p-4 rounded-lg overflow-x-auto text-sm"><code># Token almak iÃ§in
curl -X POST {{ request.scheme }}://{{ request.get_host }}/api/v1/auth/token/ \
  -H "Content-Type: application/json" \
  -d '{"email": "{{ user.email }}", "password": "YOUR_PASSWORD"}'

# Response
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc..."
}</code></pre>
                    </div>
                </div>
                
                <!-- 72h Predictions -->
                <div class="collapse collapse-arrow bg-base-200">
                    <input type="radio" name="api-accordion" />
                    <div class="collapse-title font-medium">
                        2. 72 Saatlik Tahminler
                    </div>
                    <div class="collapse-content">
                        <pre class="bg-neutral text-neutral-content p-4 rounded-lg overflow-x-auto text-sm"><code>curl {{ request.scheme }}://{{ request.get_host }}/api/v1/predictions/72h/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# Response
{
  "status": "success",
  "count": 72,
  "predictions": [
    {
      "datetime": "2024-01-15T00:00:00+03:00",
      "date": "2024-01-15",
      "hour": 0,
      "predicted_price": 2534.50,
      "lower_bound": 2281.05,
      "upper_bound": 2787.95,
      "confidence": 0.85
    },
    ...
  ]
}</code></pre>
                    </div>
                </div>
                
                <!-- Daily Summary -->
                <div class="collapse collapse-arrow bg-base-200">
                    <input type="radio" name="api-accordion" />
                    <div class="collapse-title font-medium">
                        3. GÃ¼nlÃ¼k Ã–zet
                    </div>
                    <div class="collapse-content">
                        <pre class="bg-neutral text-neutral-content p-4 rounded-lg overflow-x-auto text-sm"><code>curl {{ request.scheme }}://{{ request.get_host }}/api/v1/summary/2024-01-15/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"

# Response
{
  "status": "success",
  "date": "2024-01-15",
  "min_price": 1850.00,
  "max_price": 3200.00,
  "avg_price": 2534.50,
  "min_hour": 4,
  "max_hour": 19,
  "predictions": [...]
}</code></pre>
                    </div>
                </div>
                
                <!-- Python Example -->
                <div class="collapse collapse-arrow bg-base-200">
                    <input type="radio" name="api-accordion" />
                    <div class="collapse-title font-medium">
                        4. Python Ã–rneÄŸi
                    </div>
                    <div class="collapse-content">
                        <pre class="bg-neutral text-neutral-content p-4 rounded-lg overflow-x-auto text-sm"><code>import requests

BASE_URL = "{{ request.scheme }}://{{ request.get_host }}/api/v1"

# Token al
auth_response = requests.post(f"{BASE_URL}/auth/token/", json={
    "email": "{{ user.email }}",
    "password": "YOUR_PASSWORD"
})
token = auth_response.json()["access"]

# Tahminleri al
headers = {"Authorization": f"Bearer {token}"}
predictions = requests.get(f"{BASE_URL}/predictions/72h/", headers=headers)

print(predictions.json())</code></pre>
                    </div>
                </div>
            </div>
            
            <div class="mt-6">
                <a href="#" class="btn btn-outline">
                    ðŸ“– Tam API DokÃ¼mantasyonu
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function copyApiKey() {
    const apiKeyInput = document.getElementById('apiKey');
    apiKeyInput.select();
    document.execCommand('copy');
    
    // Toast notification
    const toast = document.createElement('div');
    toast.className = 'toast toast-top toast-end';
    toast.innerHTML = '<div class="alert alert-success"><span>API anahtarÄ± kopyalandÄ±!</span></div>';
    document.body.appendChild(toast);
    
    setTimeout(() => toast.remove(), 2000);
}
</script>
{% endblock %}
